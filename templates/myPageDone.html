<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>My Page Done</title>
    <style>
        .text-section {
            flex: 1;
            /* 공간을 남은 공간에 맞게 분배 */
            margin: 20px;
            /* 여백 추가 */
        }

        /* 메뉴 토글 버튼을 위한 CSS */
        #menuToggleBtn {
            font-size: 24px;
            /* 필요에 따라 크기를 조정합니다 */
            cursor: pointer;
        }

        /* 'active' 메뉴 상태를 위한 CSS */
        .navbar__menu.active {
            display: block;
            position: absolute;
            top: 50px;
            /* 필요에 따라 상단 위치를 조정합니다 */
            right: 0;
            background-color: white;
            z-index: 1;
        }

        .nav_bar_present {
            background-color: #E5C3A6;
            padding: 10px 30px;
            text-align: left;
            font-size: medium;
        }

        .nav_links {
            color: #943F2F;
            font-weight: bold;
        }

        .nav_link {
            text-decoration: none;
            color: #943F2F;
            transition: color 0.3s;
        }

        .nav_link:hover {
            color: white;
            font-weight: bold;
        }

        .contents {
            display: flex;
            flex-direction: column;
            align-items: baseline;
            margin-left: 30px;
            margin-top: 10px;
        }

        .centered-text {
            text-align: center;
            color: #943F2F;
        }

        .num-Ing {
            text-align: right;
            margin-right: 10px;
        }

        .done-list {
            display: flex;
            margin-left: 10px;
            margin-top: 20px;
        }

        .done-item {
            border: 1px solid black;
            border-radius: 10px;
            width: 180px;
            /* 원하는 너비로 조정 */
            height: 400px;
            /* 원하는 높이로 조정 */
            margin-right: 20px;
            /* 원하는 여백으로 조정 */
            text-align: center;
        }

        .done-item-text {
            padding: 10px;
        }

        .nav {
            display: flex;
            align-items: center;
            font-size: x-large;
            text-align: center;
            margin-left: 180px;
        }

        .nav-item {
            cursor: pointer;
            padding: 10px 20px;
            position: relative;
        }

        .nav-item:hover {
            background-color: #f4d8d8;
        }

        .nav-divider {
            width: 0.1px;
            height: 30px;
            background-color: rgb(48, 47, 47);
        }
    </style>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
</head>

<body>
    {% include 'header.html' %}

    <section>
        {% block section %}
    
        <div class="navbar">
            <div class="nav-item" data-trade="null" id="allViewBtn">전체보기</div>
            <div class="nav-divider">|</div>
            <div class="nav-item" data-trade="direct" id="directTradeBtn">직거래</div>
            <div class="nav-divider">|</div>
            <div class="nav-item" data-trade="parcel" id="parcelTradeBtn">택배거래</div>
            <div class="nav-divider">|</div>
            <div class="nav-item" data-trade="nondirect-box" id="nondirectBoxBtn">비대면상자</div>
        </div>

        <div class="done-list" id="doneListContainer">
            {% for done_item in done_items %}
                {% if (selected_trade is none) or (done_item['trans_mode'] == selected_trade) %}
                    <div class="done-item">
                        <img src="../../static/img/{{done_item.img_path}}" alt="거래 진행중 상품" width="150" height="200">
                        <div class="done-item-text">
                            {{ done_item['post_date'] }} 
                            <h3>{{ done_item['name'] }}</h3> 
                            {% if done_item['trans_mode'] == 'direct' %}
                                <img src="../../static/img/dir.png" style="width:30px; height: 30px;">
                            {% elif done_item['trans_mode'] == 'parcel' %}
                                <img src="../../static/img/pars.png" style="width:30px; height: 30px;">
                            {% elif done_item['trans_mode'] == 'nondirect-box' %}
                                <img src="../../static/img/box.png" style="width:30px; height: 30px;">
                            {% endif %}
                        </div>
                    </div>
                {% endif %}
            {% endfor %}
        </div>
    

        <!-- <script>
            // 메뉴 토글을 위한 JavaScript
            const menuToggleBtn = document.getElementById('menuToggleBtn');
            const navbarMenu = document.querySelector('.navbar__menu');
    
            menuToggleBtn.addEventListener('click', () => {
                navbarMenu.classList.toggle('active');
    
                // 클릭 시 menuBar.html로 이동
                if (navbarMenu.classList.contains('active')) {
                    window.location.href = 'menuBar.html'; // 원하는 페이지로 이동
                }
            });
        </script> -->
    
        <script>
            // 거래 항목을 업데이트하는 함수
            function updateDisplayedItems(done_items) {
                const doneListContainer = document.getElementById('doneListContainer');
                doneListContainer.innerHTML = '';

                console.log(done_items);
                done_items.forEach(item => {
                    const doneItemDiv = document.createElement('div');
                    doneItemDiv.classList.add('Done-item');

                    doneItemDiv.innerHTML = `
                        <img src="../../static/img/${item.img_path}" alt="거래 완료 상품" width="150" height="200">
                        <div class="Done-item-text">
                            ${item.post_date} 
                            <h3>${item.name}</h3> 
                            ${item.trans_mode === 'direct' ? '<img src="../../static/img/dir.png" style="width:30px; height: 30px;">' :
                            (item.trans_mode === 'parcel' ? '<img src="../../static/img/pars.png" style="width:30px; height: 30px;">' :
                                '<img src="../../static/img/box.png" style="width:30px; height: 30px;">')}
                        </div>
                    `;

                    doneListContainer.appendChild(doneItemDiv);
                });
            }
        
            document.addEventListener('DOMContentLoaded', function () {
                // 초기 로딩 시 전체보기가 선택되도록 설정
                handleTradeSelection(null);

                function handleTradeSelection(trade) {
                    fetch('/update_data2', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json;charset=UTF-8',
                        },
                        body: JSON.stringify({ selected_trade: trade }),
                    })
                    .then(response => response.json())
                    .then(data => {
                        updateDisplayedItems(data.done_items);
                    })
                    .catch(error => {
                        console.error('데이터 업데이트 오류:', error);
                    });
                }
        
                var allViewBtn = document.getElementById('allViewBtn');
                var directTradeBtn = document.getElementById('directTradeBtn');
                var parcelTradeBtn = document.getElementById('parcelTradeBtn');
                var nondirectBoxBtn = document.getElementById('nondirectBoxBtn');
        
                
                allViewBtn.addEventListener('click', function () {
                    handleTradeSelection(null);
                });
        
                directTradeBtn.addEventListener('click', function () {
                    handleTradeSelection(directTradeBtn.getAttribute('data-trade'));
                });
        
                parcelTradeBtn.addEventListener('click', function () {
                    handleTradeSelection(parcelTradeBtn.getAttribute('data-trade'));
                });
        
                nondirectBoxBtn.addEventListener('click', function () {
                    handleTradeSelection(nondirectBoxBtn.getAttribute('data-trade'));
                });
            });
        </script>

        {% endblock section %}
    </section>
    
    {% include 'footer.html' %}
</body>

</html>